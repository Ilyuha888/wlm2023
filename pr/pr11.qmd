# P11 // Дисперсионный анализ. Ковариационный анализ {#pr11 .unnumbered}

```{=html}
<!--
REPLACE ALL pr11 TO pr<n> WITH MATCH CASE
-->
```

```{r opts, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE, message = FALSE, warning = FALSE)
```

```{r pkgs, eval=TRUE}
library(tidyverse)
theme_set(theme_bw())
theme_update(legend.position = "bottom")
library(ez)
```

::: {.callout-note}
## Основной датасет

Сегодня мы вновь обратимся к данным [share](https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/share.csv) --- это тот самый поведенческий эксперимент, с которым мы работали на четвертой практике и в пятой домашке.

> В исследовании изучался зрительный поиск иконок различных платформ смартфонов. Испытуемым надо было искать иконки поделиться (share) iOS и Android среди дисктракторов --- других иконок, которые для обеих платформ отрисованы одинаково. Целевой стимул (**внутригрупповая переменная**) мог быть один --- два условия: иконка iOS (Outgoing Tray, `tray`) и иконка Android (Three Dots, `dots`) --- или их могло быть два --- и тот, и другой. Дополнительно варьировалось количество стимулов в пробе (**внутригрупповая переменная**) --- 8, 12, 16. Фиксировалось время поиска целевого стимула (время реакции) --- от начала пробы до клика испытуемого --- а также координаты клика для вычисления точности поиска. Дополнительно были записаны данные об используемой платформе смартфона (**межгрупповая переменная**) --- iOS или Android.

**Переменные в датасете:**

* `id` --- идентификатор испытуемого
* `trialtype` --- тип пробы (`dots` / `tray` / `both`)
* `setsize` --- количество стимулов в пробе (`8` / `12` / `16`)
* `platform` --- платформа, которой пользуется испытуемый (`ios` / `android`)
* `time1` --- время первого клика, с
* `time2` --- время второго клика, с
* `correct1` --- является ли первый клик верным
* `correct2` --- является ли второй клик верным

Мы будем изучать время реакции на первом клике, так как это наиболее соответствует гипотезам дисперсионного анализа.

:::

:::{.callout-note}
## Пакеты

Сегодня нам понадобятся пакеты `car` и `ez`. Проверьте, какие из них установлены на вашем компьютере, если какие-либо отсутствуют, установите их.

Можно совместить проверку и установку c помощью следующего кода:

```{r, echo=TRUE}
pkgs <- c("car", "ez")
install.packages(pkgs[!(pkgs %in% installed.packages())])
```

:::


## Основные задания {#pr11_main}

### #1

<img id="pr11-1-level" class="level"/>

::: {#pr11-1-task .task}
a. Загрузите [данные](https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/share.csv) в объект `share`.
b. Вспомните их структуру.

Мы не будем анализировать пробы с двумя целевыми стимулами, а также стоит исключить из рассмотрения пробы, в которых первый клик был некорректен.

c. Отберите из данных корректные пробы с одним целевым стимулом. Вместе с этим скорректируйте тип данных переменной `setsize` --- сделайте её фактором, чтобы в моделях она рассматривалась как категориальная переменная. Перезапишите объект `share`.
:::

```{r}
## a
share <- read_csv("https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/share.csv")
## b
str(share)
## c
share %>% 
  filter(trialtype != "both" & correct1) %>% 
  mutate(setsize = as_factor(setsize)) -> share
```
::: {#pr11-1-autocheck .autocheck}
::: {#pr11-1-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-1" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-1')">

::: {#pr11-1-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-1-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #2

<img id="pr11-2-level" class="level"/>

::: {#pr11-2-task .task}
Данные хоть и предобработаны, однако представлены в *неаггрегированным виде*: одна строка соответствует одной пробе в отдельном сочетании условий. Использовать такие данные в дисперсионном анализе некорректно, так как это будет приводить к завышению оценок эффектов факторов.

Агрегируйте (усредните) данные по времени реакции (`time1`) каждого респондента с учетом всех (квази)экспериментальных условий, то есть всех (квази)независимых переменных, включенных в исследование. Аггрегированную переменную назовите `rt` (reaction time). Сохраните результат агрегации в объект `share_agg`.
:::

```{r}
share %>% 
  summarise(rt = mean(time1),
            .by = c(id, trialtype, setsize, platform)) -> share_agg
```

::: {#pr11-2-autocheck .autocheck}
::: {#pr11-2-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-2" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-2')">

::: {#pr11-2-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-2-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #3

<img id="pr11-3-level" class="level"/>

::: {#pr11-3-task .task}
Изучим параметризацию индикаторов. Будем рассматривать влияние платформы (`platform`) на время реакции (`rt`).

a. Постройте линейную модель зависимости времени реакции от типа платформы в параметризации индикаторов.
b. Сравните результаты моделирования со средними значениями целевой переменной по уровням предиктора.
:::

```{r}
share_agg %>% 
  summarise(means = mean(rt),
            .by = platform)
model_ind <- lm(rt ~ platform, share_agg)
model_ind
summary(model_ind)
```
::: {#pr11-3-autocheck .autocheck}
::: {#pr11-3-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-3" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-3')">

::: {#pr11-3-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-3-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #4

<img id="pr11-4-level" class="level"/>

::: {#pr11-4-task .task}
Изучим параметризацию эффектов. Будем также рассматривать влияние платформы (`platform`) на время реакции (`rt`).

a. Постройте линейную модель зависимости времени реакции от типа платформы в параметризации эффектов.
b. Сравните результаты моделирования со средними значениями целевой переменной по уровням предиктора.
:::

```{r}
share_agg %>% 
  summarise(means = mean(rt),
            .by = platform)
share_agg$rt %>% mean()

model_eff <- lm(rt ~ platform, share_agg,
                contrasts = list(platform = contr.sum))
model_eff
summary(model_eff)

# 1.70776 + 0.05974
# 1.70776 - 0.05974
```

::: {#pr11-4-autocheck .autocheck}
::: {#pr11-4-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-4" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-4')">

::: {#pr11-4-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-4-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #5 {#pr11-5-title}

<img id="pr11-5-level" class="level"/>

::: {#pr11-5-task .task}
a. Проведите однофакторный анализ времени реакции по типу платформы.
b. Проинтерпретируйте результаты.
:::

```{r}
oneway_aov <- aov(rt ~ platform, share_agg)
summary(oneway_aov)
```

::: {#pr11-5-autocheck .autocheck}
::: {#pr11-5-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-5" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-5')">

::: {#pr11-5-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-5-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #6

<img id="pr11-6-level" class="level"/>

::: {#pr11-6-task .task}
В лекции говорилось, что модель дисперсионного анализа это то же самое, что и модель линейной регрессии.

a. Сравните результаты дисперсионного анализа с результатами регрессионного анализа в параметризации индикаторов и параметризации эффектов.

Мы попали в ситуацию, когда у нашего предиктора/фактора только два уровня. В лекции по этому поводу говорилось, что дисперсионный анализ и t-тест дадут нам одинаковые результаты.

b. Выполните двухвыборочный t-тест на имеющихся данных и сравните его результаты с результатами дисперсионного анализа.

:::

```{r}
## a
summary(model_ind)
summary(model_eff)
summary(oneway_aov)

## b
t.test(rt ~ platform, share_agg)
```

::: {#pr11-6-autocheck .autocheck}
::: {#pr11-6-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-6" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-6')">

::: {#pr11-6-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-6-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #7

<img id="pr11-7-level" class="level"/>

::: {#pr11-7-task .task}
Если мы имеем дело с идентичными моделями, то должен, кажется, существовать способ превращать одну в другую.

Превратите атпуты линейных моделей (в параметризации индикаторов и эффектов) в аутпуты дисперсионного анализа.
:::

```{r}
anova(model_ind)
anova(model_eff)
```

::: {#pr11-7-autocheck .autocheck}
::: {#pr11-7-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-7" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-7')">

::: {#pr11-7-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-7-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #8

<img id="pr11-8-level" class="level"/>

::: {#pr11-8-task .task}
Так как у нас две группы, то попарные сравнения бессмысленны --- по крайне мере, так было заявлено в лекции. Давайте это проверим.

t-тест мы уже проводили. Проверите попарные сравнения с помощью теста Тьюки, который считается специфичным для ANOVA способом попарных сравнений.
:::

```{r}
TukeyHSD(oneway_aov)
```

::: {#pr11-8-autocheck .autocheck}
::: {#pr11-8-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-8" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-8')">

::: {#pr11-8-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-8-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #9

<img id="pr11-9-level" class="level"/>

::: {#pr11-9-task .task}
Визуализируйте результаты для однофакторного дисперсионного анализа.
:::

```{r}
share_agg %>% 
  ggplot(aes(platform, rt)) +
  stat_summary(geom = "pointrange", fun.data = mean_cl_boot)
```

::: {#pr11-9-autocheck .autocheck}
::: {#pr11-9-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-9" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-9')">

::: {#pr11-9-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-9-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #10

<img id="pr11-10-level" class="level"/>

::: {#pr11-10-task .task}
То, что мы посмотрели различия времени реакции по используемой платформе, конечно, хорошо, но дизайн исследования одной платформате вовсе не ограничивался. Банально, мы не учли крайне важную переменную `setsize`, которая всегда фигурирует в экспериментах на зрительных поиск и существенно сказывается на времени реакции. Давайте посмотрим на нее.

a. Проведите дисперсионный анализ времени реакции по переменной `setsize`.
b. Проинтерпретируйте результаты.
:::

```{r}
ezANOVA(data = share_agg,
        dv = rt,
        within = setsize,
        wid = id,
        detailed = TRUE)
```

::: {#pr11-10-autocheck .autocheck}
::: {#pr11-10-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-10" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-10')">

::: {#pr11-10-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-10-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #11

<img id="pr11-11-level" class="level"/>

::: {#pr11-11-task .task}
При анализе влияния сетсайза на время реакции мы получили статистически значимый результат --- в общем-то ничего удивительного, странно было бы, если бы мы его не получили. Так как сетсайза у нас было три (`8`, `12`, `16`), необходимо проводить попарные сравнения (post hoc тесты), чтобы выяснить, между какими сетсайзами были различия.

Выполните попарные сравнения сетсайзов.
:::

```{r}
pairwise.t.test(x = share_agg$rt,
                g = share_agg$setsize,
                paired = TRUE)
```

::: {#pr11-11-autocheck .autocheck}
::: {#pr11-11-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-11" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-11')">

::: {#pr11-11-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-11-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #12

<img id="pr11-12-level" class="level"/>

::: {#pr11-12-task .task}
Визуализируйте результаты анализа влияния сетсайза на время реакции.
:::

```{r}
share_agg %>% 
  ggplot(aes(setsize, rt, group = 1)) +
  stat_summary(geom = "line", fun = mean,
               linetype = "dashed") +
  stat_summary(geom = "pointrange", fun.data = mean_cl_boot)
```

::: {#pr11-12-autocheck .autocheck}
::: {#pr11-12-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-12" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-12')">

::: {#pr11-12-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-12-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #13 {#pr11-13-title}

<img id="pr11-13-level" class="level"/>

::: {#pr11-13-task .task}
Окей, на сейсайз мы посмотрели, однако всё ещё дизайн исследования включал в себя три (квази)неависимые переменные сразу --- `trialtype`, `setsize` и `platform`. Давайте уже сделаем полную модель и выясним, что там все-таки с различиями.

a. Проведите смешанный дисперсионный анализ. В его модель должны входить в качестве within-subject эффектов переменные `trialtype` и `setsize`, а в качестве between-subject эффекта переменная `platform`. Зависимая переменная остается та же --- `rt`.
b. Проинтерпретируйте полученные результаты. Обратите внимание на размер эффекта.
:::

```{r}
ez_mix <- ezANOVA(data = share_agg,
        dv = rt,
        between = platform,
        within = .(setsize, trialtype),
        wid = id,
        return_aov = TRUE,
        detailed = TRUE)

ez_mix %>% psychReport::aovEffectSize()
```

::: {#pr11-13-autocheck .autocheck}
::: {#pr11-13-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-13" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-13')">

::: {#pr11-13-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-13-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #14

<img id="pr11-14-level" class="level"/>

::: {#pr11-14-task .task}
Проведите необходимые попарные сравнения для последней построенной модели.
:::

```{r}
pairwise.t.test(x = share_agg$rt,
                g = interaction(share_agg$trialtype, share_agg$setsize),
                paired = TRUE)
```

::: {#pr11-14-autocheck .autocheck}
::: {#pr11-14-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-14" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-14')">

::: {#pr11-14-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-14-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #15

<img id="pr11-15-level" class="level"/>

::: {#pr11-15-task .task}
Визуализируйте результаты смешанного дисперсионного анализа.
:::

```{r}
pd <- position_dodge(.5)
share_agg %>% 
  ggplot(aes(setsize, rt, 
             color = trialtype, 
             shape = platform,
             group = interaction(trialtype, platform))) +
  stat_summary(geom = "line", fun = mean,
               linetype = "dashed", position = pd) +
  stat_summary(geom = "pointrange", fun.data = mean_cl_boot, position = pd)
```

::: {#pr11-15-autocheck .autocheck}
::: {#pr11-15-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-15" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-15')">

::: {#pr11-15-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-15-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #16

<img id="pr11-16-level" class="level"/>

::: {#pr11-16-task .task}
В самом начале мы агрегировали данные, чтобы получить корректные результаты ANOVA. На самом деле, функция `ezANOVA()` достаточно умная, и даже если мы её передадим неагрегированные данные, она их всё равно усреднит, и мы получим тот же результат, что и на агрегированных данных.

Однако так работают не все функции. Постройте модель из [задания 5](#pr11-5-title) на неагрегированных данных и сравните результаты с тем, что получалось на агрегированных данных.
:::

```{r}
summary(aov(rt ~ platform, share_agg))
```

```{r}
summary(aov(time1 ~ platform, share))
```

::: {#pr11-16-autocheck .autocheck}
::: {#pr11-16-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-16" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-16')">

::: {#pr11-16-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-16-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #17

<img id="pr11-17-level" class="level"/>

::: {#pr11-17-task .task}
Возьмем еще одни данные --- на этот раз [о курящих детях и подростках](https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/fev.txt).

Файл содержит данные об объёме форсированного выдоха (ОФВ) (forced expiratory volume, FEV)[^fev] (`FEV`) у курящих и некурящих детей (`Smoker`: `Non`, `Current`) в возрасте (`Age`) от 3 до 19 лет и информацию о поле (`Sex`), росте (`Height`) и ID пациента (`ID`).

[^fev]: Объём воздуха, выдыхаемого за первую секунду манёвра форсированного выдоха. Используется для расчёта индекса наличия/отсутствия ухудшения проходимости дыхательных путей.

a. Загрузите данные. Проверье их структуру.
b. Постройте линейные модели, опизывающие связь ОФВ (`FEV`) с полом (`Sex`) и статусом курения (`Smoker`) в параметризации индикаторов и параметизации эффектов. Модели должны включать взаимодействие предикторов.
c. Какой тип сумм квадратов корректно использоваться в данном случае для тестирования гипотез о значимости факторов?
d. Сравните результаты тестирования гипотез о значимости факторов в случае II и III типов сумм квадратов для параметризации индикаторов и параметризации эффектов.
:::

```{r}
## a
fev <- read_tsv("https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/fev.txt")
str(fev)

fev_ind <- lm(FEV ~ Smoker * Sex, fev)
fev_eff <- lm(FEV ~ Smoker * Sex, fev,
              contrasts = list(Smoker = "contr.sum",
                               Sex = "contr.sum"))
car::Anova(fev_ind, type = "II")
car::Anova(fev_eff, type = "II")
car::Anova(fev_ind, type = "III")
car::Anova(fev_eff, type = "III")
```

::: {#pr11-17-autocheck .autocheck}
::: {#pr11-17-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-17" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-17')">

::: {#pr11-17-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-17-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #18

<img id="pr11-18-level" class="level"/>

::: {#pr11-18-task .task}
a. Визуализируйте зависимость ОФВ (`FEV`) от статуса курения (`Smoker`).
b. Изучите график. Есть ли на нем что-то странное?
c. Дополните график одно важной переменной, которую необходимо учесть в анализе для получения корректных результатов.
:::

```{r}
fev %>% 
  ggplot(aes(Smoker, FEV)) +
  stat_summary(geom = "pointrange", fun.data = mean_cl_boot)

fev %>% 
  ggplot(aes(Height, FEV, color = Smoker)) +
  geom_point() +
  geom_smooth(method = "lm")
```

::: {#pr11-18-autocheck .autocheck}
::: {#pr11-18-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-18" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-18')">

::: {#pr11-18-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-18-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #19

<img id="pr11-19-level" class="level"/>

::: {#pr11-19-task .task}
Текст задания.
:::

```{r}
fev_cov <- lm(FEV ~ Smoker * Height, fev)
drop1(fev_cov, test = "F", type = "III")
fev_cov1 <- update(fev_cov, .~. -Smoker:Height)
drop1(fev_cov1, test = "F", type = "III")
```

::: {#pr11-19-autocheck .autocheck}
::: {#pr11-19-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-19" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-19')">

::: {#pr11-19-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-19-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #20

<img id="pr11-20-level" class="level"/>

::: {#pr11-20-task .task}
Займемся экспортом результатов.

a. Экспортируйте результаты дисперсионного анализа из [задания 5](#pr11-5-title).
a. Экспортируйте результаты дисперсионного анализа из [задания 13](#pr11-13-title).
:::

```{r}
report::report(oneway_aov)
report::report(ez_mix$aov)
apaTables::apa.aov.table(oneway_aov, filename = "oneway.doc")
apaTables::apa.ezANOVA.table(ez_mix)
ez_mix %>% psychReport::aovEffectSize() %>% .$ANOVA %>% write_excel_csv("ez_mix.xlsx")
```

::: {#pr11-20-autocheck .autocheck}
::: {#pr11-20-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-20" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-20')">

::: {#pr11-20-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-20-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

## Дополнительные задания {#pr11_add}

### #1

<img id="pr11-21-level" class="level"/>

::: {#pr11-21-task .task}
Пришло время уделить внимание контрастам!

Для этого возьмем лингвистические данные. Если быть более точным, то это фонетические данные о гласных русского языка.

Нас будут интересовать следующие переменные:

- `duration` --- длительность гласного
- `reduction` --- степень редукции 
- `position` --- позиция гласного (`S` --- ударный гласный, `I` --- абсолютное начало слова, `R` --- предударный слог, `T` --- заударный слог, `F` --- абсолютный конце слова, `O` --- остальные слоги)



:::

```{r}
vowels <- read_csv("https://raw.githubusercontent.com/angelgardt/wlm2023/master/data/pr11/vowels.csv")
str(vowels)
unique(vowels$reduction)
unique(vowels$position)

vowels %>% 
  mutate(reduction = recode(reduction,
                            "no" = "1",
                            "first" = "2",
                            "second" = "3"))

```

::: {#pr11-21-autocheck .autocheck}
::: {#pr11-21-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-21" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-21')">

::: {#pr11-21-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-21-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #2

<img id="pr11-22-level" class="level"/>

::: {#pr11-22-task .task}
Текст задания.
:::

::: {#pr11-22-autocheck .autocheck}
::: {#pr11-22-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-22" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-22')">

::: {#pr11-22-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-22-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #3

<img id="pr11-23-level" class="level"/>

::: {#pr11-23-task .task}
Текст задания.
:::

::: {#pr11-23-autocheck .autocheck}
::: {#pr11-23-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-23" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-23')">

::: {#pr11-23-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-23-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #4

<img id="pr11-24-level" class="level"/>

::: {#pr11-24-task .task}
Текст задания.
:::

::: {#pr11-24-autocheck .autocheck}
::: {#pr11-24-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-24" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-24')">

::: {#pr11-24-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-24-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #5

<img id="pr11-25-level" class="level"/>

::: {#pr11-25-task .task}
Текст задания.
:::

::: {#pr11-25-autocheck .autocheck}
::: {#pr11-25-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-25" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-25')">

::: {#pr11-25-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-25-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #6

<img id="pr11-26-level" class="level"/>

::: {#pr11-26-task .task}
Текст задания.
:::

::: {#pr11-26-autocheck .autocheck}
::: {#pr11-26-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-26" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-26')">

::: {#pr11-26-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-26-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #7

<img id="pr11-27-level" class="level"/>

::: {#pr11-27-task .task}
Текст задания.
:::

::: {#pr11-27-autocheck .autocheck}
::: {#pr11-27-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-27" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-27')">

::: {#pr11-27-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-27-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #8

<img id="pr11-28-level" class="level"/>

::: {#pr11-28-task .task}
Текст задания.
:::

::: {#pr11-28-autocheck .autocheck}
::: {#pr11-28-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-28" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-28')">

::: {#pr11-28-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-28-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #9

<img id="pr11-29-level" class="level"/>

::: {#pr11-29-task .task}
Текст задания.
:::

::: {#pr11-29-autocheck .autocheck}
::: {#pr11-29-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-29" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-29')">

::: {#pr11-29-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-29-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

### #10

<img id="pr11-30-level" class="level"/>

::: {#pr11-30-task .task}
Текст задания.
:::

::: {#pr11-30-autocheck .autocheck}
::: {#pr11-30-ir .input-requirements}
Описание формата инпута.
:::

<input class="autocheck-input" type="text" id="pr11-30" placeholder="Введите ответ…">

<input class="autocheck-button" type="button" value="Проверить" onclick="check('pr11-30')">

::: {#pr11-30-fb .autocheck-feedback}
:::
:::

::: {.hints-wrapper hidden="true"}
<details class="hints" id="pr11-30-hints">

<summary>Подсказки</summary>

<details class="hint">

<summary>Как делать задание?</summary>

</details>

<details class="hint">

<summary>Что надо сделать?</summary>

</details>

<details class="hint">

<summary>Ответ неверный</summary>

</details>

</details>
:::

```{=html}
<!--- CHANGE pr11 TO pr<n> IN THE LINES BELOW--->
<script type="text/javascript" src="./js/pr11.json"></script>
<script type="text/javascript" src="./js/pr.js"></script>
```
