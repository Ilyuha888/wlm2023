{
  "hash": "ca471bff9d876b7daf3908bcf6e15c6e",
  "result": {
    "markdown": "# Оценивание статистических параметров {#stats-estim}\n<!--- {{< include _symbols.qmd >}} --->\n\n\\usepackage{xcolor}\n\\usepackage{soul}\n\n<!--- Number sets--->\n\\newcommand{\\setN}{\\mathbb{N}}\n\\newcommand{\\setNo}{\\mathbb{N}_{0}}\n\\newcommand{\\setZ}{\\mathbb{Z}}\n\\newcommand{\\setQ}{\\mathbb{Q}}\n\\newcommand{\\setR}{\\mathbb{R}}\n\\newcommand{\\setC}{\\mathbb{C}}\n\n<!--- Linear Algebra --->\n\\newcommand{\\vm}[1]{\\mathbf{#1}} <!--- vectors and matrices --->\n\n<!--- Probability, Random Vars --->\n\\newcommand{\\prob}{\\mathbb{P}}\n\\newcommand{\\var}{\\text{var}}\n\\newcommand{\\cov}{\\text{cov}}\n\\newcommand{\\cor}{\\text{cor}}\n\\newcommand{\\se}{\\text{se}}\n\\newcommand{\\sd}{\\text{sd}}\n\n\\newsavebox{\\MBox}\n\\newcommand{\\Cline}[2][red]{{\\sbox\\MBox{$#2$}%\n  \\rlap{\\usebox\\MBox}\\color{#1}\\rule[-1.2\\dp\\MBox]{\\wd\\MBox}{0.5pt}}}\n\n<!--- Distributions --->\n\\newcommand{\\norm}{\\mathcal{N}}\n\\newcommand{\\iid}{\\overset{\\text{iid}}{\\thicksim}}\n\n<!--- Other --->\n\\newcommand{\\def}{\\overset{\\text{def}}{=}}\n\\newcommand{\\sgn}{\\text{sgn}}\n\n<!--- Trig --->\n\\usepackage{amsmath}\n\\DeclareMathOperator\\artanh{artanh}\n\n\n\nМы оказываемся в сложной, но интересной ситуации. Мы хотим знать что-то про генеральную совокупность --- значение некоторого *параметра*. Но мы его никогда не узнаем, потому что не можем работать с целой генеральной совокупностью. Нам остаётся работать только с *выборочной совокупность (выборкой)* и опираться на статистические данные, которые мы собираем на ней.\n\nВыборка извлекается из генеральной совокупности случайным образом, поэтому что там именно --- с точки зрения данных --- в нашей выборке будет нам также неизвестно. Отсюда происходят два ключевых свойства статистических данных --- *неопредлённость* и *вариативность*.\n\n**Неопределённость** нам говорит о том, что мы не знаем, что именно мы получим в результате наших измерений для конкретной выборки. В том числе потому, что мы работаем на просторах случайных величин.\n\n**Вариативность** означает, что наши данные будут различатся ещё и от респондента к респонденту. И между выборками тоже. Здесь и ошибка измерения, и различные смешения и ещё куча всего.\n\nВ итоге что мы имеем: так как нам не доступны *истинные* значения параметров, придётся использовать *оценки* этих параметров.\n\n\n\n## Точечные оценки\n::: {.lab-chapter .lab-junior}\n:::\n\nПараметр обычно обозначается греческой буквой. Пусть у нас есть некоторый параметр генеральной совокупности $\\theta$. Его аналогом на выборочной совокупности является его *точечная оценка* $\\hat \\theta$. Точечная она, потому что представляет собой некоторое одно число. Таким образом, это наиболее компактный способ составить представление о значении параметра. По своей сути она, на самом деле, она является функцией от результатов наблюдений:\n\n$$\n\\hat \\theta = \\hat \\theta (x), \\; x = (x_1, x_2, \\dots, x_n)\n$$\n\nЧто это значит? То, что на разных выборках эта оценка может различаться. Возьмем для примера такой параметр как среднее значение. Предположим, что мы исследуем интеллект, и наша *генеральная совокупность* представлена таким набором наблюдений:\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(iq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10000\n```\n:::\n\n```{.r .cell-code}\nhead(iq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n     id    IQ\n  <int> <dbl>\n1     1    93\n2     2    72\n3     3    93\n4     4    91\n5     5    97\n6     6   102\n```\n:::\n\n```{.r .cell-code}\ntail(iq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n     id    IQ\n  <int> <dbl>\n1  9995   112\n2  9996   106\n3  9997    66\n4  9998    91\n5  9999    71\n6 10000    99\n```\n:::\n:::\n\n\nТак как мы предположили, что это генеральная совокупность, то мы можем посчитать истинное значение параметра $\\mu$. **В реальной жизни мы этого сделать не можем!**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(iq$IQ)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 99.6743\n```\n:::\n:::\n\n\nВполне ожидаемое значение[^1]. Теперь попробуем наизвлекать выборок человек по 50 и посчитать *оценки среднего (выборочные средние)* $\\hat \\mu$ на них:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- numeric()\nfor (i in 1:100) {\n  means[i] <- mean(sample(iq$IQ, 50, replace = FALSE))\n}\nggplot(NULL, aes(means)) +\n  geom_histogram(binwidth = 1, fill = 'royalblue4', color = 'lightgray') +\n  geom_vline(xintercept = mean(iq$IQ)) +\n  labs(x = 'Выборочные средние IQ',\n       y = 'Количество')\n```\n\n::: {.cell-output-display}\n![](stats-estim_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nНаблюдаем, что иногда мы при подсчёте оценке параметра попадаем близко к истинному его значению, иногда промахиваемся. Собственно, как раз об этом *неопределённость и вариация*.\n\n### Метод моментов\n::: {.lab-chapter .lab-junior}\n:::\n\nЧтобы получить точечные оценки параметров, используются разные методы в зависимости от конкретной модели анализа. Сейчас мы познакомимся с самым простым --- **методом моментов**.\n\nСамо название метода отсылает нас к обсуждению [характеристик распределений случайных величин](#moments_distributions). Мы говорили о том, что распредления характеризуются их *моментами*. В методе моментов есть три этапа:\n\n1) устанавливается связь между оцениваемым параметром и моментом распределения\n\n$$\n\\theta = \\xi(\\nu_k) \\quad \\text{или} \\quad \\theta = \\xi(\\mu_k)\n$$\n\n2) находятся выборочные моменты\n\n$$\n\\hat \\theta = \\xi(\\nu_k^*) \\quad \\text{или} \\quad \\hat \\theta = \\xi(\\mu_k^*)\n$$\n\n3) истинный момент заменяется на выборочный --- получается оценка.\n\nДля примера разберём всё тот же датасет с IQ. Мы знаем, что распределение баллов IQ подчинается [нормальному закону](#normal_distribution). Поэтому в качестве параметра «среднее значение коэффициента интеллекта» генеральной совокупности можно использовать математическое ожидание:\n\n$$\n\\mu = \\mathbb{E}X\n$$\n\nВыборочным аналогом математического ожидания является выборочное среднее:\n\n$$\n\\hat \\mu = \\frac{1}{n} \\sum_{i=1}^n x_i\n$$\n\nИ это, собственно, всё. Если вы хотя бы раз анализировали данные, вы имплицитно пользовались этим знанием. Просто, скорее всего, не задумывались, что это так работает. :)\n\n\n### Метод максимального правдоподобия\n::: {.lab-chapter .lab-middle}\n:::\n\n### Bootstrap\n::: {.lab-chapter .lab-middle}\n:::\n\n### Свойства точечных оценок\n::: {.lab-chapter .lab-middle}\n:::\n\nТак как точечные оценки всё же оценки, мы можем и промахнуться мимо истинного среднего --- это мы наблюдали на гистограмме. Поэтому нам надо предъявить определённые требования к точечным оценкам. Их три: *несмещённость*, *состоятельность* и *эффективность*.\n\n#### Несмещенность\n::: {.lab-chapter .lab-middle}\n:::\n\n**Несмещённость** выражает следующую идею: когда мы рассчитываем выборочную оценку, мы должны как можно ближе попадать в истинное значение параметра.\n\n$$\n\\forall n \\; \\mathbb{E} \\hat \\theta = \\theta, \\quad (\\mathbb{E}\\hat \\theta - \\theta) \\rightarrow 0,\n$$\nгде $n$ --- объём выборки, $(\\mathbb{E}\\hat \\theta - \\theta)$ --- смещение.\n\nСлева представлено требование *несмещённости при любом объёме выборки*, а справа --- *ассимптотической несмещённости*.\n\n\n#### Состоятельность\n::: {.lab-chapter .lab-middle}\n:::\n\nМатематически **состоятельность** определяется следующим образом:\n\n$$\n\\lim_{n \\rightarrow \\infty} \\mathrm{P}(|\\hat \\theta - \\theta| < \\varepsilon) = 1, \\, \\varepsilon > 0\n$$\n\nСодержательно эта запись нам говорит следующее, что при неограниченном росте мощности выборки наша оценка стремится к истинному значению параметра. Может быть, такая формулировка не совсем точна математически, но позволяет представить, что происходит. \n\n\n#### Эффективность\n::: {.lab-chapter .lab-middle}\n:::\n\nЭффективность точечной оценки определяется достаточно просто. Так как оценка параметра --- это случайная величина, но у неё есть *дисперсия*. Чтобы оценка была **эффективна**, её дисперсия должна быть минимальной:\n\n$$\n\\sigma^2_{\\hat \\theta} = \\min\n$$\n\nПример несмещённой, состоятельной и эффективной оценки --- это выборочное среднее для оценки математического ожидания нормально распределённой величины. Именно то, что мы и делали в примере применения метода моментов.\n\n\n\n## Интервальные оценки\n::: {.lab-chapter .lab-junior}\n:::\n\nКроме самого значения оценки, необходимо определить качество этой оценки, иначе говоря --- её точность. Для этого используется такая величина как **надёжность**:\n\n$$\n\\gamma = \\mathrm{P}(\\theta_\\min < \\theta < \\theta_\\max)\n$$\n\nТакая форма оценки называется **интервальной оценкой параметра**, так как мы указываем *интервал*, в котором находится истинное значение с определённой вероятностью.\n\nТакая форма оценки даёт исчерпывающую информацию о параметре: мы знаем (1) интервал, в котором находится значение параметра генеральной совокупности, а также (2) надёжность, с которой выбранный интервал накрывает это значение.\n\nЗначение надежности $\\gamma$ может быть выбрано произвольно, но обычно оно близко к единице. Однако необхожимо помнить, что чем выше надёжность, тем шире границы интервальной оценки.\n\n\n\n### Стандартная ошибка\n::: {.lab-chapter .lab-junior}\n:::\n\n\n#### Почему $\\se(X) = \\frac{\\sd(X)}{\\sqrt{n}}$\n::: {.lab-chapter .lab-senior}\n:::\n\n$$\n\\var (X + Y) = \\var (X) + \\var(Y) + 2 \\cov (X, Y)\n$$\n\n$$\n\\var (aX) = a^2 \\var (X)\n$$\n\nТак как наблюдения извлекаются из независимых одинаково распределенных величин (independent identically distributed, iid), то\n\n$$\n\\cov (X_i, X_j) = 0, \\sigma_{X_i} = \\sigma_{X_j} = \\sigma\n$$\n\n$$\n\\var \\Big( \\frac{1}{n} \\sum X_i \\Big) = \\frac{1}{n^2} \\sum \\var(X_i) = \\frac{1}{n^2} \\sum \\sigma^2 = \\frac{n}{n^2} \\sigma^2 = \\frac{\\sigma^2}{n}\n$$\n\n$$\n\\se_X = \\sqrt{ \\var \\Big( \\frac{1}{n} \\sum X_i \\Big)} = \\sqrt{\\frac{\\sigma^2}{n}} = \\frac{\\sigma}{\\sqrt{n}}\n$$\n\n\n### Доверительный интервал\n::: {.lab-chapter .lab-junior}\n:::\n\nВариантом интервальной оценки является **доверительный интервал (confidence interval)**. Итак, ещё раз:\n\n$$\n\\mathrm{P}(\\theta_\\min < \\theta < \\theta_\\max) = \\gamma, \\; \\gamma \\rightarrow 1\n$$\n\n$theta_\\min$ и $\\theta_\\max$ --- границы доверительного интервала, $\\gamma$ --- доверительная вероятность. На практике её значение чаще всего принимается равным $0.95$.\n\n**Алгоритм определения интервальной оценки** следующий:\n\n1) Найсти статистику $\\zeta(\\theta)$, связанную с оцениваниемым параметром, закон распределения которой известен $f(\\zeta)$.\n2) Определить значения $\\zeta_\\min$ и $\\zeta_\\max$, в пределах которых статистика находится с вероятностью $\\gamma$.\n3) Зная связь $\\zeta(\\theta)$ перейти к границам $\\theta_\\min$ и $\\theta_\\max$.\n\nРазберемся с этим на примере построения доверительного интервала для генерального среднего.\n\nПервая задача --- найти статистику. Мы воспользуемся тем, что за нас поработали учёные-статистики и сказали, что вот такая вполне подойдёт:\n\n$$\nt = \\frac{\\bar x - \\mu}{s}\\sqrt{n-1},\n$$\n\nгде $t$ --- значение статистики, $\\bar x$ --- выборочное среднее, $\\mu$ --- генеральное среднее, $s$ --- выборочное стандартное отклонение, $n$ --- объём выборки.\n\nИзвестен ли закон её распредления? Да. Эта статистика подчинается $t$-распределению (распределению Стьюдента). Оно похоже на нормальное, но хвосты у него повыше:\n\n<center>\n<img src=\"img/student_pdf.jpg\">\n</center>\n\nТеперь надо сформулировать вид интервальной оценки для генерального среднего. Путем арифметических преобразований формулы выше мы имеет следующее:\n\n$$\n\\mu = \\bar x - t \\frac{s}{\\sqrt{n-1}}\n$$\n\nЗначит вид интервальной оценки будет таков:\n\n$$\n\\mathrm{P}\\Big( \\bar x - t_\\alpha \\frac{s}{\\sqrt{n-1}} < \\mu < \n\\bar x + t_\\alpha \\frac{s}{\\sqrt{n-1}}\\Big) = 1 - \\alpha = \\gamma\n$$\n\nПосмотрим на картинку:\n\n<center>\n<img src=\"img/mean_ci_graph.jpeg\">\n</center>\n\nВидим на ней наш доверительный интвервал и значения $t_\\alpha$ и $-t_\\alpha$. Сама $\\alpha$ обозначает вероятность выхода за границы доверительного интервала. Осталось всё это высчитать в числах, и получить границы доверительного интервала.\n\nХорошо, что весь этот ужас в R скрыт под капотом:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_cl_normal(iq$IQ)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        y    ymin    ymax\n1 99.6743 99.3795 99.9691\n```\n:::\n\n```{.r .cell-code}\nmean_cl_boot(iq$IQ)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        y     ymin     ymax\n1 99.6743 99.38316 99.96825\n```\n:::\n:::\n\n\n[^1]: Шкала IQ устроена так, что её среднее значение равно 100, а стандартное отклонение 15.\n\n",
    "supporting": [
      "stats-estim_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}